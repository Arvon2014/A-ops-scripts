tcp {

  upstream sdkcluster {
    #ejabberd list
{% for host in groups['ejabberd_conn'] %}
{% if loop.length >= 1 %}
   server {{ hostvars[host]['hostname'] }}:5222 max_fails=15 fail_timeout=5s;
{% endif %}
{% endfor %}
  }


  server {
     listen {{sdkapi_port}};
     server_name {{sdkapi_site}};

    access_log /data/apps/log/nginx/sdk-api-access.log ;

     proxy_connect_timeout 30;
     proxy_read_timeout 600;
     proxy_send_timeout 20;

     proxy_pass sdkcluster;

  }
}




